function plan_test(plan, criteria){
  result = true
  critters = criteria.length
  for (var j=0; j< critters; j++){
    criteria_type = criteria[j][0]
    criteria_value = criteria[j][1]
    if ((criteria_type == 'carriers') && (criteria_value != plan[5]))   {result=false; break; }
    if ((criteria_type == 'metals') && (criteria_value != plan[0]))     {result=false; break; }
    if ((criteria_type == 'plan_types') && (criteria_value != plan[2])) {result=false; break; }
    if ((criteria_type == 'nationwide') && (criteria_value != String(plan[6]))) {result=false; break; }
    if ((criteria_type == 'dc_in_network') && (criteria_value != String(plan[7]))) {result=false; break; }
  }
   if (plan[3] > deductible_value) {result=false}
  return result
}
function toggle_plans(){
  window.criteria = []
  $.each($('.plan_selectors .active'), function() {
      criteria_type = this.parentNode.id
      criteria_value = this.id
      if (criteria_value != 'any') {window.criteria.push([criteria_type,criteria_value])}
    })
  for(var i = 0; i < plan_count; i++) {
      plan = window.select_plans[i]
      value = "[value~=" + plan[4] + "]"
      display = plan_test(plan, window.criteria) ? 'inline' : 'none'
      $(value).parent().css('display', display)
  }
}


window.relationships = ['employee', 'spouse', 'domestic_partner', 'child_under_26', 'child_26_and_over']
function slider_listeners () {
    $('#ex1').bootstrapSlider({});
    $('#total_plan_cost').bootstrapSlider({});
    $('#pct_employee').bootstrapSlider({});
    $('#pct_spouse').bootstrapSlider({});
    $('#pct_domestic_partner').bootstrapSlider({});
    $('#under_26').bootstrapSlider({});
    $('#over_26').bootstrapSlider({});

    $('#ex1').on('slideStop', function(){deductible_value = this.value; 
      toggle_plans();
      console.log(this.value, 'v')
    })
    $('#pct_employee').on('slideStop', function() {
        val =$('#pct_employee').bootstrapSlider('getValue')
        set_relationship_pct('employee', val)
       })
    $('#pct_spouse').on('slideStop', function() {
          val =$('#pct_spouse').bootstrapSlider('getValue')
          set_relationship_pct('spouse', val)
         })
    $('#pct_domestic_partner').on('slideStop', function() {
          val =$('#pct_domestic_partner').bootstrapSlider('getValue')
          set_relationship_pct('domestic_partner', val)
         })
    $('#under_26').on('slideStop', function() {
          val =$('#under_26').bootstrapSlider('getValue')
          set_relationship_pct('child_under_26', val)
         })
    $('#over_26').on('slideStop', function() {
          val =$('#over_26').bootstrapSlider('getValue')
          set_relationship_pct('child_26_and_over', val)
         })

}
function set_relationship_pct(relationship, val) {
  window.relationship_benefits[relationship] = val
  $("[name~='" + relationship + "']").val(val)
  $.ajax({
    type: 'POST',
    data: {benefits: window.relationship_benefits, id: $('#quote option').val() },
    url: '/broker_agencies/quotes/update_benefits.js',
  }).done(function(response){
    window.plan_costs = response
  }) 
}