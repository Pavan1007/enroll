$('#<%= @location_id %> <%= @coverage_type %>.selected-plan').html("<%= escape_javascript(render(partial: "employers/plan_years/plan_selection/plan_details")).html_safe %>")
$("#<%= @location_id %> <%= @coverage_type %>.selected-plan h2.employer-monthly-cost").html("<%= number_to_currency(@employer_contribution_amount.to_f) %>");
$("#<%= @location_id %> <%= @coverage_type %>.selected-plan .employee-monthly-cost-min").html("<%= number_to_currency(@min_employee_cost.to_f) %>");
$("#<%= @location_id %> <%= @coverage_type %>.selected-plan .employee-monthly-cost-max").html("<%= number_to_currency(@max_employee_cost.to_f) %>");
if ( $("#<%= @location_id %> .select-dental-plan").is(":hidden") ) {
  // $('#<%#=# @location_id %> label.elected_plan:contains("Custom")').trigger('click');
  // $('#<%#=# @location_id %> .elected-plans-continue span').trigger('click');
}
$("#<%= @location_id %> .select-dental-plan").show();
$('#<%= @location_id %> .dental-benefits-fields .col-xs-6.form-group.form-group-lg label > input').attr('disabled', 'disabled');
$("#<%= @location_id %> .dental .dental-config-links, #<%= @location_id %> <%= @coverage_type %> .change-dental-reference-plan").show();
$("#<%= @location_id %> <%= @coverage_type %> <%= @coverage_type %>-view-summary").show();

if ( '<%= @coverage_type %>' == '.dental' ) {
  $("#<%= @location_id %> .dental-reference-plans, #<%= @location_id %> .dental.selected-plan > .row:first").hide();

  if ( $("#<%= @location_id %> <%= @coverage_type %> label:contains('Custom')").closest('li').find('input').is(':checked') ) {
    if ( $('#<%= @location_id %> .elected-plans-tab input[type=checkbox]').length == $('#<%= @location_id %> .elected-plans-tab input[type=checkbox]:checked').length ) {
      $('#<%= @location_id %> <%= @coverage_type %> .dental-config-reference-selection').text('Currently Offering: All Plans');
    } else {
      $('#<%= @location_id %> <%= @coverage_type %> .dental-config-reference-selection').text('Currently Offering: '+$('#<%= @location_id %> .elected-plans-tab input[type=checkbox]:checked').length+ ' Plans');
    }

  } else {

  }

   $('#<%= @location_id %> .select-dental-plan h4 .starter:first + span').show();
   if (window.location.href.indexOf("edit") > -1 && window.location.href.indexOf("plan_years") > -1) {
    $('#<%= @location_id %> <%= @coverage_type %> .reference-steps > div:first').hide();
    $('#<%= @location_id %> <%= @coverage_type %>.selected-plan').show();
    $('#<%= @location_id %> <%= @coverage_type %> .change-dental-reference-plan').on('click', function() {

      $(this).closest('.selected-plan').hide();
      $(this).closest('#<%= @location_id %>').find('.dental .edit-offering, .dental .nav-tabs, .dental .plan-options, .dental .dental').show();
      $(this).closest('#<%= @location_id %>').find('.dental .referenceplan').hide();
      $('#<%= @location_id %> <%= @coverage_type %> .reference-steps > div:first').show();
      $('#<%= @location_id %> <%= @coverage_type %> .edit-offering').hide();
      $('#<%= @location_id %> <%= @coverage_type %> .currently-offering').html('You currently offer <%= @plan.name %>.');
    });
    $('#<%= @location_id %> <%= @coverage_type %> .dental-config-reference-selection').on('click', function() {
      $('#<%= @location_id %> <%= @coverage_type %> .dental:first').show();
      $('#<%= @location_id %> <%= @coverage_type %> .carriers-tab').show();
    });

  } else {
    $('#<%= @location_id %> .dental .change-dental-reference-plan').on('click', function() {
      $('#<%= @location_id %> .dental.selected-plan').slideUp();
      $('#<%= @location_id %> .dental-reference-plans').slideDown();
    });
  }
} else {

  if ( window.location.href.indexOf("edit") > -1 && window.location.href.indexOf("plan_years") > -1 ) {
    $("#<%= @location_id %> .health.selected-plan .row:first").hide();
    $('#<%= @location_id %> .reference-steps:first').hide();
    $('#<%= @location_id %> .health .col-xs-12:first').show();

    $("#<%= @location_id %> .health .health .change-dental-reference-plan").on('click', function() {
      $(this).closest('.selected-plan').hide();
      $(this).closest('#<%= @location_id %>').find('.reference-steps:first').show();
      $('#<%= @location_id %> .reference-steps:first .currently-offered').html('You currently offer <%= @plan.name %>.');
      $('#<%= @location_id %> .reference-steps:first .currently-offering').html('You currently offer <%= @plan.name %>.');
    });
  } else {
    $('#<%= @location_id %> .health .change-dental-reference-plan').hide();
    $('#<%= @location_id %> .health .dental-config-reference-selection').hide();
  }
  $("#<%= @location_id %> .health .dental-config-links").show();

}

$("#<%= @location_id %> <%= @coverage_type %> .change-dental-reference-plan").on('click', function() {
  $("#<%= @location_id %> <%= @coverage_type %>-view-summary").hide();
  $("#<%= @location_id %> <%= @coverage_type %> .dental-config-reference-selection").hide();
});



$('#<%= @location_id %> <%= @coverage_type %> .dental-config-reference-selection').on('click', function() {
  $('#<%= @location_id %> <%= @coverage_type %> .reference-steps > div:first').show();
  $('#<%= @location_id %> <%= @coverage_type %>.selected-plan, #<%= @location_id %> <%= @coverage_type %> .carriers-tab').hide();
  $('#<%= @location_id %> <%= @coverage_type %> .nav-tabs, #<%= @location_id %> <%= @coverage_type %> .plan-options, #<%= @location_id %> <%= @coverage_type %> .dental-plan-offering').show();
  $("#<%= @location_id %> .dental-ref-plan").val("","");

  $("#<%= @location_id %> .dental .plan-options input[type=radio]").removeAttr('checked');
  if ( '<%= @coverage_type %>' == '.dental' ) {

  } else {
    $('#<%= @location_id %> .reference-steps:first').show();
  }

  if ( $("#<%= @location_id %> .dental .nav-tabs label:first").closest('.li').hasClass('active') == true ) {
  } else {
    // $("#<%= @location_id %> .dental .nav-tabs label:first").trigger('click');
  }
});


// make view summary link
var summaryLink = $('#<%= @location_id %> <%= @coverage_type %> .reference-plan input:checked').closest('.reference-plan').find('.view-summary').attr('href');
$('#<%= @location_id %> <%= @coverage_type %>-view-summary a').attr('href', summaryLink+"&link=link");

     $("#<%= @location_id %> <%= @coverage_type %> #employer_cost_info_btn .btn, #<%= @location_id %> <%= @coverage_type %> #edit_employer_cost_info_btn").click(function(){
      var location_id = $(this).parents('.benefit-group-fields').attr('id');

      if ( $(this).closest('.health').length > 0 ) {
        var coverage_type = '.health';
        var reference_plan_id = $("#<%= @location_id %> .health .ref-plan").val();
      } else {
        var coverage_type = '.dental';
        var reference_plan_id = $("#<%= @location_id %> .dental .dental-ref-plan").val();
      }

      if (reference_plan_id == "" || reference_plan_id == undefined) {
        return
      }
      console.log(reference_plan_id+" "+coverage_type+" "+location_id);
      calcEmployerContributions($('a#employee_costs_link').attr('href'), location_id, coverage_type);
    });
